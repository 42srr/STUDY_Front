[모던 자바스크립트 Deep Dive]
[13장] 스코프

---

### 1. 스코프란?

- 스코프

	- 식별자가 유효한 범위, 식별자를 검색할 때 사용하는 규칙(네임스페이스)
	
	- 모든 식별자(변수 이름, 함수 이름, 클래스 이름 등)는 자신이 선언된 위치에 의해 다른 코드가 식별자 자신을 참조할 수 있는 유효 범위가 결정됨

- 식별자 결정

	- 자바스크립트 엔진이 스코프를 통해 이름이 같은 두 개의 변수 중에서 어떤 변수를 참조할 것인지

	- 같은 스코프 내 중복 불가능, 스코프로 충돌 방지
	
	- 이름이 동일한 식별자여도 스코프가 다르면 별개의 변수로 취급함
	
		- var x = 1; function foo() { var x = 2; console.log(x); } foo(); -> 2

- 렉시컬 환경

	- 코드가 어디서 실행되며 주변에 어떤 코드가 있는지
	
	- 자바스크립트 엔진은 코드 실행 시 코드의 문맥을 고려하며, 렉시컬 환경으로 이뤄짐
	
	- 이를 구현한 것이 실행 컨텍스트이며, 모든 코드는 실행 컨텍스트에서 평가되고 실행됨

---

### 2. 스코프의 종류

- 코드는 전역, 지역으로 구분되며

- 변수는 자신이 선언된 위치에 의해 자신이 유효한 범위인 스코프가 결정됨

#### 전역과 전역 스코프

- 전역

	- 코드의 가장 바깥 영역
	
- 전역에 변수를 선언하면 전역 스코프를 갖는 전역 변수가 됨 (어디서든지 참조 가능)

#### 지역과 지역 스코프

- 지역

	- 함수 몸체 내부
	
- 지역에 변수를 선언하면 지역 스코프를 갖는 지역 변수가 됨 (자신이 선언된 지역, 하위 지역(중첩 함수)에서만 참조 가능)

---

### 3. 스코프 체인

- 변수를 참조할 때 자바스크립트 엔진은 스코프 체인을 통해 변수를 참조하는 코드의 스코프에서 시작하여 상위 스코프 방향으로 이동하며 선언된 변수를 검색함

- 스코프 체인

	- 스코프가 계층적으로 연결된 것
	
	- 스코프가 함수의 중첩에 의해 계층적 구조를 가짐 (스코프도 중첩됨)
	
	- 전역 스코프 > outer 지역 스코프 > inner 지역 스코프

- 자바스크립트엔진은 렉시컬 환경을 실제 생성, 변수 선언 실행 시 변수 식별자가 키로 등록되고, 변수 할당이 일어나면 해당하는 값을 변경함

- 렉시컬 환경

	- 스코프 체인은 실행 컨텍스트의 렉시컬 환경을 단방향으로 연결한 것
	
	- 전역 렉시컬 환경은 코드가 로드되면 곧바로 생성되고 함수의 렉시컬 환경은 함수가 호출되면 곧바로 생성됨
	
#### 스코프 체인에 의한 변수 검색

- 자바스크립트 엔진은 스코프 체인을 따라 변수 참조 코드의 스코프 -> 상위 스코프 방향으로 이동하며 선언된 변수를 검색함

	- x의 참조 inner에서 지역 스코프에 x 검색, 종료
	
	- y의 참조 inner에서 지역 스코프에 y 검색, 상위 스코프 outer 함수의 지역 스코프에 검색, ...

- 상위 스코프에서 유효한 변수는 하위 스코프에서 자유롭게 참조 가능하지만, 하위 스코프는 그렇지 않음

#### 스코프 체인에 의한 함수 검색

- 스코프는 식별자를 검색하는 규칙임

	- 변수와 같이 함수도 식별자에 할당되기 때문에 스코프를 가짐

---

### 4. 함수 레벨 스코프

- 코드 블록이 아닌 함수에 의해서만 지역 스코프가 생성됨

	- 지역은 함수 몸체 내부를 말하고 지역은 지역 스코프를 만듦
	
- 블록 레벨 스코프

	- 함수 몸체만이 아니라 모든 코드 블록이 지역 스코프를 만듦
	
- 함수 레벨 스코프

	- var 키워드로 선언된 변수는 오로지 함수의 코드 블록(함수 몸체)만을 지역 스코프로 인정함

	- var 키워드로 선언된 변수는 전역 변수가 됨
	
		- var i = 1; for (var i=0; i<3; i++) console.log(i); console.log(i); -> 0123
---

### 5. 렉시컬 스코프

- 동적 스코프

	- 함수를 어디서 호출했는지에 따라 함수의 상위 스코프를 결정
	
- 렉시컬 스코프

	- 함수를 어디서 정의했는지에 따라 함수의 상위 스코프를 결정

- 자바스크립트는 렉시컬 스코프에 따라 상위 스코프를 결정함

	- var x = 1; function foo() { var x = 2; bar(); } function bar() { console.log(x); } -> 11

	- 함수의 상위 스코프는 언제나 자신이 정의된 스코프임
	
	- 이처럼 함수의 상위 스코프는 함수 정의가 실행될 때 정적으로 결정하여 기억하고, 호출 때마다 참조함

---
